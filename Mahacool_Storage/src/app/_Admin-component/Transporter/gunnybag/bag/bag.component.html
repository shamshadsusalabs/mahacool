<div class="p-4">
  <!-- Action Buttons and Search Bar -->
  <div class="flex justify-between items-center mb-4">
    <div class="space-x-2">
      <button (click)="openModal()" class="bg-blue-600 text-white px-4 py-2 rounded-md shadow-md hover:bg-blue-700 transition" aria-label="Print QR Code">Print QR</button>
      <button (click)="openAddModal()" class="bg-blue-600 text-white px-4 py-2 rounded-md shadow-md hover:bg-blue-700 transition" aria-label="Add New Bag">Add Bag</button>
    </div>
    <app-add-gunny-bag *ngIf="openAddModalis" (modalClosed)="closeModalAdd()" (formSubmitted)=" fetchData() "></app-add-gunny-bag>
    <app-qr-code *ngIf="isModalOpen" (closeModal)="closeModal()"></app-qr-code>

    <!-- Search Bar and Date Picker -->
    <div class="flex items-center space-x-2 w-1/2">
      <input
        type="text"
        placeholder="Search"
        class="w-2/3 px-4 py-2 rounded-md shadow-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        aria-label="Search by Customer ID, City Name, Rack Name, or Warehouse Name">


    </div>
  </div>

  <!-- Data Table -->
  <div *ngIf="paginatedItems.length > 0" class="mt-20">
    <table class="min-w-full bg-white border border-gray-300">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="py-2 px-4 border-b">Customer ID</th>
          <th class="py-2 px-4 border-b">Date</th>
          <th class="py-2 px-4 border-b">City Name</th>
          <th class="py-2 px-4 border-b">Warehouse Name</th>
          <th class="py-2 px-4 border-b">Rack Name</th>
          <th class="py-2 px-4 border-b">Type of Sack</th>
          <th class="py-2 px-4 border-b">Dry Fruit Name</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let item of paginatedItems">
          <ng-container *ngFor="let checkIn of item.checkInHistory">
            <tr class="bg-gray-50">
              <td class="py-2 px-4 border-b">{{ item.customerId }}</td>
              <td class="py-2 px-4 border-b" *ngIf="checkIn.dateCheckIN">{{ checkIn.dateCheckIN | date:'short' }}</td>
              <td class="py-2 px-4 border-b" *ngFor="let dryFruit of checkIn.dryFruits">{{ dryFruit.cityName }}</td>
              <td class="py-2 px-4 border-b" *ngFor="let dryFruit of checkIn.dryFruits">{{ dryFruit.warehouseName }}</td>
              <td class="py-2 px-4 border-b" *ngFor="let dryFruit of checkIn.dryFruits">{{ dryFruit.rackName }}</td>
              <td class="py-2 px-4 border-b" *ngFor="let dryFruit of checkIn.dryFruits">{{ dryFruit.typeOfSack }}</td>
              <td class="py-2 px-4 border-b" *ngFor="let dryFruit of checkIn.dryFruits">{{ dryFruit.name }}</td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>
  <div *ngIf="paginatedItems.length === 0" class="text-center py-4">No data available</div>

  <!-- Pagination Controls -->
  <div class="flex justify-between items-center mt-4">
    <div>
      <label for="itemsPerPage" class="mr-2">Items per page:</label>
      <select id="itemsPerPage" [(ngModel)]="itemsPerPage" (change)="onPageChange(1)">
        <option *ngFor="let size of [5, 10, 20]" [value]="size">{{ size }}</option>
      </select>
    </div>
    <div class="flex space-x-2">
      <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l" (click)="onPageChange(1)" [disabled]="currentPage === 1">First</button>
      <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
      <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
      <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r" (click)="onPageChange(totalPages)" [disabled]="currentPage === totalPages">Last</button>
    </div>
  </div>
</div>
